{"ast":null,"code":"import _regeneratorRuntime from\"/home/sujai/Documents/pegasus projects/-MS_E-commerce_Pegasus_Tep_Online_Full-time_2021_8/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/sujai/Documents/pegasus projects/-MS_E-commerce_Pegasus_Tep_Online_Full-time_2021_8/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/sujai/Documents/pegasus projects/-MS_E-commerce_Pegasus_Tep_Online_Full-time_2021_8/amazon-clone/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import CheckoutProduct from\"./CheckoutProduct\";import\"./Payment.css\";import{useStateValue}from\"./StateProvider\";import{Link,useHistory}from\"react-router-dom\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import CurrencyFormat from\"react-currency-format\";import{getBasketTotal}from\"./reducer\";import axios from\"./axios\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],basket=_useStateValue2$.basket,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:'POST',url:\"/payments/create?total=\".concat(getBasketTotal(basket))});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;// payment confirmation\nsetSucceeded(true);setError(null);setProcessing(false);history.replace('/orders');});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){// listens the change in cardelement\n// and display any errors\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/_jsx(\"div\",{className:\"payment\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"payment__container\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Checkout (\",/*#__PURE__*/_jsxs(Link,{to:\"/checkout\",children:[basket===null||basket===void 0?void 0:basket.length,\" items\"]}),\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Delivery Address\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__address\",children:[/*#__PURE__*/_jsx(\"p\",{children:user===null||user===void 0?void 0:user.email}),/*#__PURE__*/_jsx(\"p\",{children:\"NO 40 Marina beach\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Chennai,India\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Review Items and Delivery\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__items\",children:basket.map(function(item){return/*#__PURE__*/_jsx(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__section\"}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__title\",children:/*#__PURE__*/_jsx(\"h3\",{children:\"Payment Method\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"payment__details\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{onChange:handleChange}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment__priceContainer\",children:[/*#__PURE__*/_jsx(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/_jsxs(\"h3\",{children:[\"Order Total: \",value]});},decimalScale:2,value:getBasketTotal(basket),displayType:\"text\",thousandSeparator:true,prefix:\"â‚¹\"}),/*#__PURE__*/_jsx(\"button\",{disabled:processing||disabled||succeeded,children:/*#__PURE__*/_jsx(\"span\",{children:processing?/*#__PURE__*/_jsx(\"p\",{children:\"Processing\"}):\"Buy Now\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{children:error})]})})]})});}export default Payment;","map":{"version":3,"sources":["/home/sujai/Documents/pegasus projects/-MS_E-commerce_Pegasus_Tep_Online_Full-time_2021_8/amazon-clone/src/Payment.js"],"names":["React","useEffect","useState","CheckoutProduct","useStateValue","Link","useHistory","CardElement","useStripe","useElements","CurrencyFormat","getBasketTotal","axios","Payment","basket","user","dispatch","history","stripe","elements","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","replace","payload","handleChange","empty","message","length","email","map","item","id","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport CheckoutProduct from \"./CheckoutProduct\";\nimport \"./Payment.css\";\nimport { useStateValue } from \"./StateProvider\";\nimport { Link, useHistory } from \"react-router-dom\";\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\nimport CurrencyFormat from \"react-currency-format\";\nimport { getBasketTotal } from \"./reducer\";\nimport axios from \"./axios\";\n\nfunction Payment() {\n  const [{ basket, user }, dispatch] = useStateValue();\n const history = useHistory();\n  const stripe = useStripe();\n  const elements = useElements();\n\n  const [succeeded, setSucceeded] = useState(false);\n  const [processing, setProcessing] = useState(\"\");\n  const [error, setError] = useState(null);\n  const [disabled, setDisabled] = useState(true);\n  const [clientSecret, setClientSecret] = useState(true);\n\n  useEffect(() =>{\n\n    const getClientSecret = async () => {\n      const response = await axios({\n        method: 'POST',\n        url: `/payments/create?total=${getBasketTotal(basket)}`\n      })\n      setClientSecret(response.data.clientSecret)\n\n    }\n    getClientSecret();\n  },[])\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n    setProcessing(true);\n\n    const payload = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: elements.getElement(CardElement)\n      }\n    }).then(( {paymentIntent}) => {\n        // payment confirmation\n        setSucceeded(true);\n        setError(null);\n        setProcessing(false);\n\n        history.replace('/orders')\n    })\n  };\n  const handleChange = (event) => {\n    // listens the change in cardelement\n    // and display any errors\n    setDisabled(event.empty);\n    setError(event.error ? event.error.message : \"\");\n  };\n  return (\n    <div className=\"payment\">\n      <div className=\"payment__container\">\n        <h1>\n          Checkout (<Link to=\"/checkout\">{basket?.length} items</Link>)\n        </h1>\n        {/* payment sec / address */}\n        <div className=\"payment__section\">\n          <div className=\"payment__title\">\n            <h3>Delivery Address</h3>\n          </div>\n          <div className=\"payment__address\">\n            <p>{user?.email}</p>\n            <p>NO 40 Marina beach</p>\n            <p>Chennai,India</p>\n          </div>\n        </div>\n        {/* payment sec / items review */}\n        <div className=\"payment__section\">\n          <div className=\"payment__title\">\n            <h3>Review Items and Delivery</h3>\n          </div>\n          <div className=\"payment__items\">\n            {basket.map((item) => (\n              <CheckoutProduct\n                id={item.id}\n                title={item.title}\n                image={item.image}\n                price={item.price}\n                rating={item.rating}\n              />\n            ))}\n          </div>\n        </div>\n        {/* payment sec / Payment Method*/}\n        <div className=\"payment__section\"></div>\n        <div className=\"payment__title\">\n          <h3>Payment Method</h3>\n        </div>\n        <div className=\"payment__details\">\n          {/* Stripe payment */}\n          <form onSubmit={handleSubmit}>\n            <CardElement onChange={handleChange} />\n            <div className=\"payment__priceContainer\">\n              <CurrencyFormat\n                renderText={(value) => <h3>Order Total: {value}</h3>}\n                decimalScale={2}\n                value={getBasketTotal(basket)}\n                displayType={\"text\"}\n                thousandSeparator={true}\n                prefix={\"â‚¹\"}\n              />\n              <button disabled={processing || disabled || succeeded}>\n                <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\n              </button>\n            </div>\n            {/* Errors */}\n            {error && <div>{error}</div>}\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Payment;\n"]},"metadata":{},"sourceType":"module"}